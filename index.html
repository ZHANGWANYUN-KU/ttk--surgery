<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>ç–¼ç—›ç§‘æ‰‹æœ¯æ’ç¨‹ç³»ç»Ÿ</title>
  
  <!-- Polyfills for IE compatibility -->
  <script>
    // Polyfill for Object.assign (IE11)
    if (typeof Object.assign != 'function') {
      Object.assign = function(target) {
        'use strict';
        if (target == null) {
          throw new TypeError('Cannot convert undefined or null to object');
        }
        var to = Object(target);
        for (var index = 1; index < arguments.length; index++) {
          var nextSource = arguments[index];
          if (nextSource != null) {
            for (var nextKey in nextSource) {
              if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {
                to[nextKey] = nextSource[nextKey];
              }
            }
          }
        }
        return to;
      };
    }
    
    // Polyfill for Array.from (IE11)
    if (!Array.from) {
      Array.from = function(arrayLike, mapFn, thisArg) {
        var C = this;
        var items = Object(arrayLike);
        if (arrayLike == null) {
          throw new TypeError('Array.from requires an array-like object - not null or undefined');
        }
        var mapFunction = mapFn !== undefined;
        var T;
        if (typeof mapFn !== 'undefined') {
          if (typeof mapFn !== 'function') {
            throw new TypeError('Array.from: when provided, the second argument must be a function');
          }
          if (arguments.length > 2) {
            T = thisArg;
          }
        }
        var len = parseInt(items.length) || 0;
        var A = typeof C === 'function' ? Object(new C(len)) : new Array(len);
        var k = 0;
        var kValue;
        while (k < len) {
          kValue = items[k];
          if (mapFunction) {
            A[k] = typeof T === 'undefined' ? mapFn(kValue, k) : mapFn.call(T, kValue, k);
          } else {
            A[k] = kValue;
          }
          k += 1;
        }
        A.length = len;
        return A;
      };
    }
    
    // Polyfill for String.includes (IE11)
    if (!String.prototype.includes) {
      String.prototype.includes = function(search, start) {
        'use strict';
        if (typeof start !== 'number') {
          start = 0;
        }
        if (start + search.length > this.length) {
          return false;
        } else {
          return this.indexOf(search, start) !== -1;
        }
      };
    }
    
    // Polyfill for Array.includes (IE11)
    if (!Array.prototype.includes) {
      Array.prototype.includes = function(searchElement, fromIndex) {
        'use strict';
        if (this == null) {
          throw new TypeError('Array.prototype.includes called on null or undefined');
        }
        var O = Object(this);
        var len = parseInt(O.length) || 0;
        if (len === 0) {
          return false;
        }
        var n = parseInt(fromIndex) || 0;
        var k;
        if (n >= 0) {
          k = n;
        } else {
          k = len + n;
          if (k < 0) {
            k = 0;
          }
        }
        function sameValueZero(x, y) {
          return x === y || (typeof x === 'number' && typeof y === 'number' && isNaN(x) && isNaN(y));
        }
        for (; k < len; k++) {
          if (sameValueZero(O[k], searchElement)) {
            return true;
          }
        }
        return false;
      };
    }
    
    // Polyfill for Array.find (IE11)
    if (!Array.prototype.find) {
      Array.prototype.find = function(predicate) {
        if (this == null) {
          throw new TypeError('Array.prototype.find called on null or undefined');
        }
        if (typeof predicate !== 'function') {
          throw new TypeError('predicate must be a function');
        }
        var list = Object(this);
        var length = parseInt(list.length) || 0;
        var thisArg = arguments[1];
        var value;
        for (var i = 0; i < length; i++) {
          value = list[i];
          if (predicate.call(thisArg, value, i, list)) {
            return value;
          }
        }
        return undefined;
      };
    }
    
    // Polyfill for Array.findIndex (IE11)
    if (!Array.prototype.findIndex) {
      Array.prototype.findIndex = function(predicate) {
        if (this == null) {
          throw new TypeError('Array.prototype.findIndex called on null or undefined');
        }
        if (typeof predicate !== 'function') {
          throw new TypeError('predicate must be a function');
        }
        var list = Object(this);
        var length = parseInt(list.length) || 0;
        var thisArg = arguments[1];
        var value;
        for (var i = 0; i < length; i++) {
          value = list[i];
          if (predicate.call(thisArg, value, i, list)) {
            return i;
          }
        }
        return -1;
      };
    }
    
    // Polyfill for URL.createObjectURL (IE11)
    if (!window.URL) {
      window.URL = window.URL || window.webkitURL || window.mozURL || window.msURL;
    }
    if (!URL.createObjectURL) {
      URL.createObjectURL = function(blob) {
        if (window.navigator && window.navigator.msSaveOrOpenBlob) {
          return window.navigator.msSaveOrOpenBlob(blob);
        }
        var url = window.URL || window.webkitURL || window.mozURL || window.msURL;
        return url ? url.createObjectURL(blob) : null;
      };
    }
    if (!URL.revokeObjectURL) {
      URL.revokeObjectURL = function(url) {
        var urlObj = window.URL || window.webkitURL || window.mozURL || window.msURL;
        if (urlObj) {
          urlObj.revokeObjectURL(url);
        }
      };
    }
  </script>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React & ReactDOM (ä½¿ç”¨å…¼å®¹ç‰ˆæœ¬) -->
  <script src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
  
  <!-- Babel Standalone for JSX transformation -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    @keyframes fade-in-down {
      from {
        opacity: 0;
        transform: translate(-50%, -10px);
      }
      to {
        opacity: 1;
        transform: translate(-50%, 0);
      }
    }
    .animate-fade-in-down {
      animation: fade-in-down 0.3s ease-out;
    }
    @keyframes fade-in {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes zoom-in-95 {
      from { transform: scale(0.95); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    .animate-in {
      animation: fade-in 0.2s ease-out;
    }
    .zoom-in-95 {
      animation: zoom-in-95 0.2s ease-out;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // Icon Components (simplified SVG versions)
    const Calendar = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
    );
    const Clock = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    );
    const User = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
      </svg>
    );
    const Activity = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
      </svg>
    );
    const Plus = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
      </svg>
    );
    const ChevronLeft = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
      </svg>
    );
    const ChevronRight = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
      </svg>
    );
    const MapPin = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
    );
    const FileText = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
    );
    const Trash2 = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
      </svg>
    );
    const Edit2 = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
      </svg>
    );
    const CheckCircle = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    );
    const XCircle = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    );
    const ClipboardList = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
      </svg>
    );
    const Copy = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
      </svg>
    );
    const Stethoscope = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
      </svg>
    );
    const Syringe = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
      </svg>
    );
    const AlertCircle = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    );
    const Bed = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
      </svg>
    );
    const UserCheck = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    );
    const Hash = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14" />
      </svg>
    );
    const Target = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
      </svg>
    );
    const FileSpreadsheet = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
    );
    const Download = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
      </svg>
    );
    const Upload = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
      </svg>
    );

    // æœ¬åœ°å­˜å‚¨ç®¡ç†ï¼ˆæ›¿ä»£ Firebaseï¼‰
    const STORAGE_KEY = 'surgery_schedule_data';

    const StorageService = {
      // è·å–æ‰€æœ‰æ•°æ®
      getAll: () => {
        try {
          const data = localStorage.getItem(STORAGE_KEY);
          return data ? JSON.parse(data) : [];
        } catch (e) {
          console.error('è¯»å–æ•°æ®å¤±è´¥', e);
          return [];
        }
      },

      // ä¿å­˜æ‰€æœ‰æ•°æ®
      saveAll: (data) => {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
          return true;
        } catch (e) {
          console.error('ä¿å­˜æ•°æ®å¤±è´¥', e);
          return false;
        }
      },

      // æ·»åŠ æ–°è®°å½•
      add: (record) => {
        const all = StorageService.getAll();
        const newRecord = {
          ...record,
          id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString()
        };
        all.push(newRecord);
        StorageService.saveAll(all);
        return newRecord;
      },

      // æ›´æ–°è®°å½•
      update: (id, updates) => {
        const all = StorageService.getAll();
        const index = all.findIndex(item => item.id === id);
        if (index !== -1) {
          all[index] = {
            ...all[index],
            ...updates,
            updatedAt: new Date().toISOString()
          };
          StorageService.saveAll(all);
          return all[index];
        }
        return null;
      },

      // åˆ é™¤è®°å½•
      delete: (id) => {
        const all = StorageService.getAll();
        const filtered = all.filter(item => item.id !== id);
        StorageService.saveAll(filtered);
        return true;
      },

      // ç›‘å¬æ•°æ®å˜åŒ–ï¼ˆæ¨¡æ‹Ÿå®æ—¶æ›´æ–°ï¼‰
      subscribe: (callback) => {
        // ä½¿ç”¨ storage äº‹ä»¶ç›‘å¬è·¨æ ‡ç­¾é¡µå˜åŒ–
        const handleStorageChange = (e) => {
          if (e.key === STORAGE_KEY) {
            callback(StorageService.getAll());
          }
        };
        window.addEventListener('storage', handleStorageChange);
        
        // å®šæœŸæ£€æŸ¥æœ¬åœ°å˜åŒ–ï¼ˆåŒä¸€æ ‡ç­¾é¡µå†…ï¼‰
        const interval = setInterval(() => {
          callback(StorageService.getAll());
        }, 1000);

        return () => {
          window.removeEventListener('storage', handleStorageChange);
          clearInterval(interval);
        };
      }
    };

    function SurgeryScheduler() {
      const [surgeries, setSurgeries] = useState([]);
      const [loading, setLoading] = useState(true);
      const [selectedDate, setSelectedDate] = useState(new Date());
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [isCalendarOpen, setIsCalendarOpen] = useState(false);
      const [calendarViewDate, setCalendarViewDate] = useState(new Date());
      const [editingSurgery, setEditingSurgery] = useState(null);
      const [notification, setNotification] = useState(null);
      const [timeRange, setTimeRange] = useState({ start: '00:00', end: '23:59' });
      const [isTimeRangeActive, setIsTimeRangeActive] = useState(false);
      const [dateRange, setDateRange] = useState({ 
        start: new Date().toISOString().split('T')[0], 
        end: new Date().toISOString().split('T')[0]
      });
      const [isDateRangeActive, setIsDateRangeActive] = useState(false);

      const [formData, setFormData] = useState({
        patientName: '',
        mrn: '',
        age: '',
        bedNumber: '',
        sequence: '',
        surgeryName: '',
        needleSize: '',
        surgeon: '',
        assistant1: '',
        assistant2: '',
        anesthesiologist: '',
        circulatingNurse: '',
        room: '',
        startTime: '08:00',
        notes: '',
        status: 'pending'
      });

      // ä¸»åˆ€åŒ»å¸ˆé€‰é¡¹åˆ—è¡¨
      const surgeonOptions = ['é»„å‰', 'å®‹å›½å¹³', 'å´è±ª', 'ç”°ç”±', 'æ¨æ°´èŠ¬', 'éƒ‘é‘«', 'å¼ ä¸‡äº‘', 'å¼ æ–‡ç§‘', 'å…¶ä»–'];

      // åŠ è½½æ•°æ®
      useEffect(() => {
        // åˆå§‹åŠ è½½
        setSurgeries(StorageService.getAll());
        setLoading(false);

        // è®¢é˜…æ•°æ®å˜åŒ–
        const unsubscribe = StorageService.subscribe((data) => {
          setSurgeries(data);
        });

        return unsubscribe;
      }, []);

      const formatDateKey = (date) => {
        return date.toISOString().split('T')[0];
      };

      const getDaySurgeries = useMemo(() => {
        let filtered = surgeries;
        
        // å¦‚æœå¯ç”¨äº†æ—¥æœŸèŒƒå›´è¿‡æ»¤
        if (isDateRangeActive && dateRange.start && dateRange.end) {
          filtered = filtered.filter(s => {
            const surgeryDate = s.date;
            return surgeryDate >= dateRange.start && surgeryDate <= dateRange.end;
          });
        } else {
          // å¦åˆ™åªæ˜¾ç¤ºé€‰ä¸­æ—¥æœŸçš„æ•°æ®
          const targetDate = formatDateKey(selectedDate);
          filtered = filtered.filter(s => s.date === targetDate);
        }
        
        // å¦‚æœå¯ç”¨äº†æ—¶é—´æ®µè¿‡æ»¤
        if (isTimeRangeActive && timeRange.start && timeRange.end) {
          filtered = filtered.filter(surgery => {
            if (!surgery.startTime) return false;
            const surgeryTime = surgery.startTime;
            return surgeryTime >= timeRange.start && surgeryTime <= timeRange.end;
          });
        }
        
        return filtered.sort((a, b) => {
          // å…ˆæŒ‰æ—¥æœŸæ’åº
          if (a.date !== b.date) {
            return a.date.localeCompare(b.date);
          }
          // åŒä¸€å¤©å†…æŒ‰å°æ¬¡æˆ–æ—¶é—´æ’åº
          if (a.sequence && b.sequence) {
            return parseInt(a.sequence) - parseInt(b.sequence);
          }
          return (a.startTime || '').localeCompare(b.startTime || '');
        });
      }, [surgeries, selectedDate, isTimeRangeActive, timeRange, isDateRangeActive, dateRange]);

      // æŸ¥è¯¢ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ”¯æŒæ—¶é—´æ®µå’Œæ—¥æœŸèŒƒå›´ï¼‰
      const queryStats = useMemo(() => {
        const stats = {
          total: getDaySurgeries.length,
          byRoom: {},
          bySurgeon: {},
          byDate: {},
          byStatus: { pending: 0, ongoing: 0, completed: 0, cancelled: 0 }
        };

        getDaySurgeries.forEach(surgery => {
          // æŒ‰æ—¥æœŸç»Ÿè®¡
          if (surgery.date) {
            stats.byDate[surgery.date] = (stats.byDate[surgery.date] || 0) + 1;
          }

          // æŒ‰æ‰‹æœ¯é—´ç»Ÿè®¡
          const room = surgery.room || 'æœªå®š';
          stats.byRoom[room] = (stats.byRoom[room] || 0) + 1;

          // æŒ‰ä¸»åˆ€åŒ»ç”Ÿç»Ÿè®¡
          if (surgery.surgeon) {
            stats.bySurgeon[surgery.surgeon] = (stats.bySurgeon[surgery.surgeon] || 0) + 1;
          }

          // æŒ‰çŠ¶æ€ç»Ÿè®¡
          if (surgery.status) {
            stats.byStatus[surgery.status] = (stats.byStatus[surgery.status] || 0) + 1;
          }
        });

        return stats;
      }, [getDaySurgeries]);

      const showNotification = (message, type = 'success') => {
        setNotification({ message, type });
        setTimeout(() => setNotification(null), 3000);
      };

      const handleDateChange = (days) => {
        const newDate = new Date(selectedDate);
        newDate.setDate(newDate.getDate() + days);
        setSelectedDate(newDate);
      };

      const handleCalendarDateSelect = (date) => {
        setSelectedDate(date);
        setIsCalendarOpen(false);
      };

      const handleCalendarMonthChange = (months) => {
        const newDate = new Date(calendarViewDate);
        newDate.setMonth(newDate.getMonth() + months);
        setCalendarViewDate(newDate);
      };

      // ç”Ÿæˆæ—¥å†ç½‘æ ¼
      const getCalendarDays = () => {
        const year = calendarViewDate.getFullYear();
        const month = calendarViewDate.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = firstDay.getDay();
        
        const days = [];
        
        // æ·»åŠ ä¸Šä¸ªæœˆçš„æ—¥æœŸ
        const prevMonth = new Date(year, month - 1, 0);
        const prevMonthDays = prevMonth.getDate();
        for (let i = startingDayOfWeek - 1; i >= 0; i--) {
          days.push({
            date: new Date(year, month - 1, prevMonthDays - i),
            isCurrentMonth: false,
            isToday: false
          });
        }
        
        // æ·»åŠ å½“å‰æœˆçš„æ—¥æœŸ
        const today = new Date();
        for (let i = 1; i <= daysInMonth; i++) {
          const date = new Date(year, month, i);
          days.push({
            date: date,
            isCurrentMonth: true,
            isToday: date.toDateString() === today.toDateString()
          });
        }
        
        // æ·»åŠ ä¸‹ä¸ªæœˆçš„æ—¥æœŸä»¥å¡«æ»¡ç½‘æ ¼
        const remainingDays = 42 - days.length;
        for (let i = 1; i <= remainingDays; i++) {
          days.push({
            date: new Date(year, month + 1, i),
            isCurrentMonth: false,
            isToday: false
          });
        }
        
        return days;
      };

      const resetForm = () => {
        setFormData({
          patientName: '',
          mrn: '',
          age: '',
          bedNumber: '',
          sequence: '',
          surgeryName: '',
          needleSize: '',
          surgeon: '',
          assistant1: '',
          assistant2: '',
          anesthesiologist: '',
          circulatingNurse: '',
          room: '',
          startTime: '08:00',
          notes: '',
          status: 'pending'
        });
        setEditingSurgery(null);
      };

      // CRUD æ“ä½œ
      const handleSubmit = async (e) => {
        e.preventDefault();

        const dataToSave = {
          ...formData,
          date: formatDateKey(selectedDate)
        };

        try {
          if (editingSurgery) {
            StorageService.update(editingSurgery.id, dataToSave);
            showNotification('æ‰‹æœ¯ä¿¡æ¯å·²æ›´æ–°');
          } else {
            StorageService.add(dataToSave);
            showNotification('æ–°æ‰‹æœ¯å·²æ·»åŠ ');
          }
          setIsModalOpen(false);
          resetForm();
        } catch (error) {
          console.error("Error saving:", error);
          showNotification('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
        }
      };

      const handleDelete = async (id) => {
        if (!window.confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡æ‰‹æœ¯è®°å½•å—ï¼Ÿ')) return;
        try {
          StorageService.delete(id);
          showNotification('è®°å½•å·²åˆ é™¤');
        } catch (error) {
          console.error("Error deleting:", error);
        }
      };

      const updateStatus = async (id, newStatus) => {
        try {
          StorageService.update(id, { status: newStatus });
        } catch (error) {
          console.error("Error updating status:", error);
        }
      };

      const copyToClipboard = () => {
        if (getDaySurgeries.length === 0) {
          showNotification('ä»Šæ—¥æ— æ’ç¨‹å¯å¤åˆ¶', 'error');
          return;
        }

        const dateStr = selectedDate.toLocaleDateString('zh-CN', { month: 'long', day: 'numeric', weekday: 'long' });
        let text = `ğŸ“… ${dateStr} æ‰‹æœ¯æ’ç¨‹\n----------------\n`;
        
        getDaySurgeries.forEach((s, index) => {
          const seqStr = s.sequence ? `ç¬¬${s.sequence}å°` : `${index + 1}`;
          const bedStr = s.bedNumber ? `${s.bedNumber}åºŠ` : '';
          const ageStr = s.age ? `${s.age}å²` : '';
          const needleStr = s.needleSize ? `[é’ˆ:${s.needleSize}]` : '';
          
          text += `${seqStr}. [${s.room || 'å¾…å®š'}] ${s.startTime} ${s.patientName} ${bedStr} ${ageStr} ${needleStr}\n`;
          text += `   æœ¯å¼: ${s.surgeryName}\n`;
          text += `   ä¸»åˆ€: ${s.surgeon || '-'}`;
          if (s.assistant1) text += ` | åŠ©æ‰‹1: ${s.assistant1}`;
          if (s.assistant2) text += ` | åŠ©æ‰‹2: ${s.assistant2}`;
          if (s.anesthesiologist) text += ` | éº»é†‰: ${s.anesthesiologist}`;
          if (s.circulatingNurse) text += ` | å·¡å›: ${s.circulatingNurse}`;
          text += '\n';
          if(s.notes) text += `   å¤‡æ³¨: ${s.notes}\n`;
          text += `\n`;
        });

        const textArea = document.createElement("textarea");
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        try {
          document.execCommand('copy');
          showNotification('æ’ç¨‹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        } catch (err) {
          console.error('Copy failed', err);
          showNotification('å¤åˆ¶å¤±è´¥', 'error');
        }
        document.body.removeChild(textArea);
      };

      const handleExportCSV = () => {
        if (getDaySurgeries.length === 0) {
          showNotification('ä»Šæ—¥æ— æ•°æ®å¯å¯¼å‡º', 'error');
          return;
        }

        const headers = [
          'æ—¥æœŸ', 'å°æ¬¡', 'æ—¶é—´', 'æ‰‹æœ¯é—´', 
          'ç—…äººå§“å', 'å¹´é¾„', 'åºŠå·', 'ä½é™¢å·', 
          'æ‰‹æœ¯åç§°', 'ç©¿åˆºé’ˆ', 
          'ä¸»åˆ€', 'åŠ©æ‰‹1', 'åŠ©æ‰‹2', 'éº»é†‰', 'å·¡å›', 
          'çŠ¶æ€', 'å¤‡æ³¨'
        ];

        const getStatusText = (s) => {
          switch(s) {
            case 'completed': return 'å·²å®Œæˆ';
            case 'ongoing': return 'æœ¯ä¸­';
            case 'cancelled': return 'å·²å–æ¶ˆ';
            default: return 'å¾…æœ¯';
          }
        };

        const escapeCsv = (field) => {
          if (field === null || field === undefined) return '';
          const stringField = String(field);
          if (stringField.includes(',') || stringField.includes('"') || stringField.includes('\n')) {
            return `"${stringField.replace(/"/g, '""')}"`;
          }
          return stringField;
        };

        const dateStr = selectedDate.toLocaleDateString('zh-CN');
        
        const csvContent = [
          headers.join(','),
          ...getDaySurgeries.map(s => [
            escapeCsv(dateStr),
            escapeCsv(s.sequence || ''),
            escapeCsv(s.startTime),
            escapeCsv(s.room),
            escapeCsv(s.patientName),
            escapeCsv(s.age),
            escapeCsv(s.bedNumber),
            escapeCsv(s.mrn),
            escapeCsv(s.surgeryName),
            escapeCsv(s.needleSize),
            escapeCsv(s.surgeon),
            escapeCsv(s.assistant1),
            escapeCsv(s.assistant2),
            escapeCsv(s.anesthesiologist),
            escapeCsv(s.circulatingNurse),
            escapeCsv(getStatusText(s.status)),
            escapeCsv(s.notes)
          ].join(','))
        ].join('\n');

        const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `æ‰‹æœ¯æ’ç¨‹_${dateStr.replace(/\//g, '-')}.csv`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        showNotification('å¯¼å‡ºæˆåŠŸ');
      };

      // å¯¼å‡ºæ‰€æœ‰æ•°æ®ï¼ˆç”¨äºè·¨è®¾å¤‡åŒæ­¥ï¼‰
      const handleExportData = () => {
        try {
          const allData = StorageService.getAll();
          if (allData.length === 0) {
            showNotification('æš‚æ— æ•°æ®å¯å¯¼å‡º', 'error');
            return;
          }
          
          const exportData = {
            version: '1.0',
            exportDate: new Date().toISOString(),
            data: allData
          };
          
          const dataStr = JSON.stringify(exportData, null, 2);
          
          // IE11å…¼å®¹å¤„ç†
          if (window.navigator && window.navigator.msSaveOrOpenBlob) {
            var blob = new Blob([dataStr], { type: 'application/json' });
            window.navigator.msSaveOrOpenBlob(blob, 'æ‰‹æœ¯æ’ç¨‹æ•°æ®_' + new Date().toISOString().split('T')[0] + '.json');
            showNotification('æ•°æ®å¯¼å‡ºæˆåŠŸ');
          } else {
            var blob = new Blob([dataStr], { type: 'application/json' });
            var url = URL.createObjectURL(blob);
            var link = document.createElement('a');
            link.href = url;
            link.download = 'æ‰‹æœ¯æ’ç¨‹æ•°æ®_' + new Date().toISOString().split('T')[0] + '.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            setTimeout(function() {
              URL.revokeObjectURL(url);
            }, 100);
            showNotification('æ•°æ®å¯¼å‡ºæˆåŠŸ');
          }
        } catch (error) {
          console.error('Export failed', error);
          showNotification('å¯¼å‡ºå¤±è´¥', 'error');
        }
      };

      // å¯¼å…¥æ•°æ®ï¼ˆç”¨äºè·¨è®¾å¤‡åŒæ­¥ï¼‰
      const handleImportData = () => {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = function(e) {
          const file = e.target.files[0];
          if (!file) return;
          
          const reader = new FileReader();
          reader.onload = function(event) {
            try {
              const importData = JSON.parse(event.target.result);
              
              // éªŒè¯æ•°æ®æ ¼å¼
              if (!importData.data || !Array.isArray(importData.data)) {
                showNotification('æ•°æ®æ ¼å¼é”™è¯¯', 'error');
                return;
              }
              
              // ç¡®è®¤å¯¼å…¥
              if (!window.confirm('å¯¼å…¥æ•°æ®å°†è¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼Œç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
                return;
              }
              
              // ä¿å­˜å¯¼å…¥çš„æ•°æ®
              StorageService.saveAll(importData.data);
              setSurgeries(importData.data);
              showNotification('æ•°æ®å¯¼å…¥æˆåŠŸ');
            } catch (error) {
              console.error('Import failed', error);
              showNotification('å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼', 'error');
            }
          };
          reader.onerror = function() {
            showNotification('æ–‡ä»¶è¯»å–å¤±è´¥', 'error');
          };
          reader.readAsText(file);
        };
        input.click();
      };

      const getStatusColor = (status) => {
        switch(status) {
          case 'completed': return 'bg-green-100 text-green-700 border-green-200';
          case 'ongoing': return 'bg-blue-100 text-blue-700 border-blue-200';
          case 'cancelled': return 'bg-red-50 text-red-400 border-red-100 opacity-60';
          default: return 'bg-white text-slate-700 border-slate-200';
        }
      };

      return (
        <div className="min-h-screen bg-slate-50 text-slate-800 font-sans pb-20 md:pb-10">
          {notification && (
            <div className={`fixed top-4 left-1/2 transform -translate-x-1/2 z-50 px-6 py-3 rounded-full shadow-lg text-sm font-medium animate-fade-in-down ${
              notification.type === 'error' ? 'bg-red-500 text-white' : 'bg-emerald-600 text-white'
            }`}>
              {notification.message}
            </div>
          )}

          <header className="bg-white shadow-sm sticky top-0 z-10">
            <div className="max-w-5xl mx-auto px-4 py-4">
              <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div className="flex items-center gap-2">
                  <div className="bg-blue-600 p-2 rounded-lg">
                    <Activity className="w-6 h-6 text-white" />
                  </div>
                  <div>
                    <h1 className="text-xl font-bold text-slate-900">ç–¼ç—›ç§‘æ‰‹æœ¯æ’ç¨‹ç³»ç»Ÿ</h1>
                    <p className="text-xs text-slate-500">Pain Department Surgery Schedule System</p>
                  </div>
                </div>

                <div className="flex items-center gap-4 bg-slate-100 p-1 rounded-lg self-start md:self-auto relative">
                  <button 
                    onClick={() => handleDateChange(-1)} 
                    className="p-2 hover:bg-white rounded-md transition-colors text-slate-600"
                    title="å‰ä¸€å¤©"
                  >
                    <ChevronLeft className="w-5 h-5" />
                  </button>
                  <button
                    onClick={() => {
                      setCalendarViewDate(new Date(selectedDate));
                      setIsCalendarOpen(true);
                    }}
                    className="flex items-center gap-2 px-2 min-w-[160px] justify-center font-medium hover:bg-white rounded-md transition-colors cursor-pointer"
                  >
                    <Calendar className="w-4 h-4 text-blue-600" />
                    <span>
                      {selectedDate.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' })}
                    </span>
                    <span className="text-sm text-slate-400 ml-1">
                      {selectedDate.toLocaleDateString('zh-CN', { weekday: 'short' })}
                    </span>
                  </button>
                  <button 
                    onClick={() => handleDateChange(1)} 
                    className="p-2 hover:bg-white rounded-md transition-colors text-slate-600"
                    title="åä¸€å¤©"
                  >
                    <ChevronRight className="w-5 h-5" />
                  </button>

                  {/* æ—¥å†å¼¹å‡ºçª—å£ */}
                  {isCalendarOpen && (
                    <>
                      <div 
                        className="fixed inset-0 z-40"
                        onClick={() => setIsCalendarOpen(false)}
                      ></div>
                      <div className="fixed md:absolute top-20 md:top-full right-4 md:right-auto md:left-0 md:mt-2 bg-white rounded-xl shadow-2xl border border-slate-200 p-4 z-50 w-[calc(100vw-2rem)] md:w-80 max-w-sm mx-auto md:mx-0 animate-in fade-in zoom-in-95">
                        <div className="flex items-center justify-between mb-4">
                          <button
                            onClick={() => handleCalendarMonthChange(-1)}
                            className="p-1 hover:bg-slate-100 rounded-md transition-colors"
                          >
                            <ChevronLeft className="w-5 h-5 text-slate-600" />
                          </button>
                          <h3 className="font-semibold text-slate-800">
                            {calendarViewDate.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long' })}
                          </h3>
                          <button
                            onClick={() => handleCalendarMonthChange(1)}
                            className="p-1 hover:bg-slate-100 rounded-md transition-colors"
                          >
                            <ChevronRight className="w-5 h-5 text-slate-600" />
                          </button>
                        </div>
                        
                        <div className="grid grid-cols-7 gap-1 mb-2">
                          {['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'].map(day => (
                            <div key={day} className="text-center text-xs font-semibold text-slate-500 py-1">
                              {day}
                            </div>
                          ))}
                        </div>
                        
                        <div className="grid grid-cols-7 gap-1">
                          {getCalendarDays().map((day, index) => {
                            const isSelected = day.date.toDateString() === selectedDate.toDateString();
                            return (
                              <button
                                key={index}
                                onClick={() => handleCalendarDateSelect(day.date)}
                                className={`
                                  aspect-square p-1 rounded-md text-sm transition-colors
                                  ${!day.isCurrentMonth ? 'text-slate-300' : 'text-slate-700'}
                                  ${isSelected ? 'bg-blue-600 text-white font-semibold' : ''}
                                  ${!isSelected && day.isCurrentMonth ? 'hover:bg-blue-50' : ''}
                                  ${day.isToday && !isSelected ? 'bg-blue-100 font-semibold' : ''}
                                `}
                              >
                                {day.date.getDate()}
                              </button>
                            );
                          })}
                        </div>
                        
                        <div className="mt-4 pt-4 border-t border-slate-200 flex gap-2">
                          <button
                            onClick={() => {
                              const today = new Date();
                              setSelectedDate(today);
                              setCalendarViewDate(today);
                            }}
                            className="flex-1 px-3 py-2 text-sm bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 font-medium transition-colors"
                          >
                            ä»Šå¤©
                          </button>
                          <button
                            onClick={() => setIsCalendarOpen(false)}
                            className="flex-1 px-3 py-2 text-sm bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-200 font-medium transition-colors"
                          >
                            å…³é—­
                          </button>
                        </div>
                      </div>
                    </>
                  )}
                </div>
              </div>
            </div>
          </header>

          <main className="max-w-5xl mx-auto px-4 py-6">
            {/* æ—¥æœŸèŒƒå›´æŸ¥è¯¢å™¨ */}
            <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-6">
              <div className="flex flex-col md:flex-row md:items-center gap-4">
                <div className="flex items-center gap-2">
                  <Calendar className="w-5 h-5 text-blue-600" />
                  <h2 className="text-lg font-bold text-slate-800">æ—¥æœŸèŒƒå›´æŸ¥è¯¢</h2>
                </div>
                
                <div className="flex-1 flex flex-wrap items-center gap-3">
                  <label className="flex items-center gap-2 text-sm text-slate-600">
                    <input
                      type="checkbox"
                      checked={isDateRangeActive}
                      onChange={(e) => {
                        setIsDateRangeActive(e.target.checked);
                        if (!e.target.checked) {
                          // å…³é—­æ—¶é‡ç½®ä¸ºå½“å‰æ—¥æœŸ
                          const today = new Date().toISOString().split('T')[0];
                          setDateRange({ start: today, end: today });
                        }
                      }}
                      className="w-4 h-4 text-blue-600 rounded focus:ring-blue-500"
                    />
                    <span>å¯ç”¨æ—¥æœŸèŒƒå›´æŸ¥è¯¢</span>
                  </label>
                  
                  {isDateRangeActive && (
                    <>
                      <div className="flex items-center gap-2">
                        <label className="text-sm text-slate-600">å¼€å§‹æ—¥æœŸ:</label>
                        <input
                          type="date"
                          value={dateRange.start}
                          onChange={(e) => {
                            const newStart = e.target.value;
                            setDateRange(prev => ({
                              ...prev,
                              start: newStart,
                              // å¦‚æœå¼€å§‹æ—¥æœŸæ™šäºç»“æŸæ—¥æœŸï¼Œè‡ªåŠ¨è°ƒæ•´ç»“æŸæ—¥æœŸ
                              end: newStart > prev.end ? newStart : prev.end
                            }));
                          }}
                          className="px-3 py-1.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"
                        />
                      </div>
                      <div className="flex items-center gap-2">
                        <label className="text-sm text-slate-600">ç»“æŸæ—¥æœŸ:</label>
                        <input
                          type="date"
                          value={dateRange.end}
                          min={dateRange.start}
                          onChange={(e) => setDateRange({...dateRange, end: e.target.value})}
                          className="px-3 py-1.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"
                        />
                      </div>
                      <button
                        onClick={() => {
                          const today = new Date().toISOString().split('T')[0];
                          setDateRange({ start: today, end: today });
                          setIsDateRangeActive(false);
                        }}
                        className="px-3 py-1.5 text-sm text-slate-600 hover:text-slate-800 hover:bg-slate-100 rounded-lg transition-colors"
                      >
                        æ¸…é™¤ç­›é€‰
                      </button>
                      {dateRange.start && dateRange.end && dateRange.start !== dateRange.end && (
                        <span className="text-xs text-slate-500">
                          å…± {Math.ceil((new Date(dateRange.end) - new Date(dateRange.start)) / (1000 * 60 * 60 * 24)) + 1} å¤©
                        </span>
                      )}
                    </>
                  )}
                </div>
              </div>
            </div>

            {/* æ—¶é—´æ®µæŸ¥è¯¢å™¨ */}
            <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-6">
              <div className="flex flex-col md:flex-row md:items-center gap-4">
                <div className="flex items-center gap-2">
                  <Clock className="w-5 h-5 text-blue-600" />
                  <h2 className="text-lg font-bold text-slate-800">æ—¶é—´æ®µæŸ¥è¯¢ç»Ÿè®¡</h2>
                </div>
                
                <div className="flex-1 flex flex-wrap items-center gap-3">
                  <label className="flex items-center gap-2 text-sm text-slate-600">
                    <input
                      type="checkbox"
                      checked={isTimeRangeActive}
                      onChange={(e) => setIsTimeRangeActive(e.target.checked)}
                      className="w-4 h-4 text-blue-600 rounded focus:ring-blue-500"
                    />
                    <span>å¯ç”¨æ—¶é—´æ®µæŸ¥è¯¢</span>
                  </label>
                  
                  {isTimeRangeActive && (
                    <>
                      <div className="flex items-center gap-2">
                        <label className="text-sm text-slate-600">å¼€å§‹æ—¶é—´:</label>
                        <input
                          type="time"
                          value={timeRange.start}
                          onChange={(e) => {
                            const newStart = e.target.value;
                            setTimeRange(prev => ({
                              ...prev,
                              start: newStart,
                              // å¦‚æœå¼€å§‹æ—¶é—´æ™šäºç»“æŸæ—¶é—´ï¼Œè‡ªåŠ¨è°ƒæ•´ç»“æŸæ—¶é—´
                              end: newStart > prev.end ? newStart : prev.end
                            }));
                          }}
                          className="px-3 py-1.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"
                        />
                      </div>
                      <div className="flex items-center gap-2">
                        <label className="text-sm text-slate-600">ç»“æŸæ—¶é—´:</label>
                        <input
                          type="time"
                          value={timeRange.end}
                          min={timeRange.start}
                          onChange={(e) => setTimeRange({...timeRange, end: e.target.value})}
                          className="px-3 py-1.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"
                        />
                      </div>
                      <button
                        onClick={() => {
                          setTimeRange({ start: '00:00', end: '23:59' });
                          setIsTimeRangeActive(false);
                        }}
                        className="px-3 py-1.5 text-sm text-slate-600 hover:text-slate-800 hover:bg-slate-100 rounded-lg transition-colors"
                      >
                        æ¸…é™¤ç­›é€‰
                      </button>
                    </>
                  )}
                </div>
                
                <div className="bg-blue-50 px-4 py-2 rounded-lg border border-blue-200">
                  <div className="flex items-center gap-2">
                    <Activity className="w-4 h-4 text-blue-600" />
                    <span className="text-slate-600 text-sm">æŸ¥è¯¢ç»“æœ:</span>
                    <span className="text-xl font-bold text-blue-600">{queryStats.total}å°</span>
                  </div>
                </div>
              </div>
            </div>

            {/* æŸ¥è¯¢ç»Ÿè®¡ä¿¡æ¯é¢æ¿ */}
            {(isTimeRangeActive || isDateRangeActive) && queryStats.total > 0 && (
              <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-6">
                <div className="flex items-center gap-2 mb-4">
                  <Activity className="w-5 h-5 text-blue-600" />
                  <h2 className="text-lg font-bold text-slate-800">
                    {isDateRangeActive && isTimeRangeActive
                      ? `æ—¥æœŸèŒƒå›´+æ—¶é—´æ®µç»Ÿè®¡ (${dateRange.start} è‡³ ${dateRange.end}, ${timeRange.start}-${timeRange.end})`
                      : isDateRangeActive
                        ? `æ—¥æœŸèŒƒå›´ç»Ÿè®¡ (${dateRange.start} è‡³ ${dateRange.end})`
                        : `æ—¶é—´æ®µç»Ÿè®¡ (${timeRange.start} - ${timeRange.end})`}
                  </h2>
                </div>
                
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  {/* æŒ‰æ‰‹æœ¯é—´ç»Ÿè®¡ */}
                  <div className="bg-slate-50 rounded-lg p-3">
                    <div className="flex items-center gap-2 mb-2">
                      <MapPin className="w-4 h-4 text-slate-600" />
                      <span className="text-sm font-semibold text-slate-700">æ‰‹æœ¯é—´åˆ†å¸ƒ</span>
                    </div>
                    <div className="space-y-1">
                      {Object.keys(queryStats.byRoom).length > 0 ? (
                        Object.entries(queryStats.byRoom)
                          .sort((a, b) => b[1] - a[1])
                          .map(([room, count]) => (
                            <div key={room} className="flex justify-between text-sm">
                              <span className="text-slate-600">{room}</span>
                              <span className="font-semibold text-slate-800">{count}å°</span>
                            </div>
                          ))
                      ) : (
                        <div className="text-xs text-slate-400">æš‚æ— æ•°æ®</div>
                      )}
                    </div>
                  </div>

                  {/* æŒ‰ä¸»åˆ€åŒ»ç”Ÿç»Ÿè®¡ */}
                  <div className="bg-slate-50 rounded-lg p-3">
                    <div className="flex items-center gap-2 mb-2">
                      <User className="w-4 h-4 text-slate-600" />
                      <span className="text-sm font-semibold text-slate-700">ä¸»åˆ€åŒ»ç”Ÿ</span>
                    </div>
                    <div className="space-y-1">
                      {Object.keys(queryStats.bySurgeon).length > 0 ? (
                        Object.entries(queryStats.bySurgeon)
                          .sort((a, b) => b[1] - a[1])
                          .slice(0, 5)
                          .map(([surgeon, count]) => (
                            <div key={surgeon} className="flex justify-between text-sm">
                              <span className="text-slate-600 truncate">{surgeon}</span>
                              <span className="font-semibold text-slate-800 ml-2">{count}å°</span>
                            </div>
                          ))
                      ) : (
                        <div className="text-xs text-slate-400">æš‚æ— æ•°æ®</div>
                      )}
                    </div>
                  </div>

                  {/* æŒ‰çŠ¶æ€ç»Ÿè®¡ */}
                  <div className="bg-slate-50 rounded-lg p-3">
                    <div className="flex items-center gap-2 mb-2">
                      <CheckCircle className="w-4 h-4 text-slate-600" />
                      <span className="text-sm font-semibold text-slate-700">çŠ¶æ€åˆ†å¸ƒ</span>
                    </div>
                    <div className="space-y-1">
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-600">å¾…æœ¯</span>
                        <span className="font-semibold text-yellow-600">{queryStats.byStatus.pending}å°</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-600">æœ¯ä¸­</span>
                        <span className="font-semibold text-blue-600">{queryStats.byStatus.ongoing}å°</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-600">å·²å®Œæˆ</span>
                        <span className="font-semibold text-emerald-600">{queryStats.byStatus.completed}å°</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-600">å·²å–æ¶ˆ</span>
                        <span className="font-semibold text-red-500">{queryStats.byStatus.cancelled}å°</span>
                      </div>
                    </div>
                  </div>
                </div>

                {/* æ±‡æ€»ä¿¡æ¯ */}
                <div className="mt-4 pt-4 border-t border-slate-200">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div className="bg-blue-50 rounded-lg p-3 border border-blue-100">
                      <div className="text-xs text-blue-600 font-medium mb-1">æ€»å°æ¬¡</div>
                      <div className="text-2xl font-bold text-blue-700">{queryStats.total}</div>
                    </div>
                    <div className="bg-slate-50 rounded-lg p-3 border border-slate-200">
                      <div className="text-xs text-slate-600 font-medium mb-1">æ‰‹æœ¯é—´æ•°</div>
                      <div className="text-2xl font-bold text-slate-700">{Object.keys(queryStats.byRoom).length}</div>
                    </div>
                    <div className="bg-slate-50 rounded-lg p-3 border border-slate-200">
                      <div className="text-xs text-slate-600 font-medium mb-1">ä¸»åˆ€åŒ»ç”Ÿæ•°</div>
                      <div className="text-2xl font-bold text-slate-700">{Object.keys(queryStats.bySurgeon).length}</div>
                    </div>
                  </div>

                  {/* æŒ‰æ—¥æœŸåˆ†ç»„ç»Ÿè®¡ï¼ˆä»…åœ¨å¯ç”¨æ—¥æœŸèŒƒå›´æ—¶æ˜¾ç¤ºï¼‰ */}
                  {isDateRangeActive && Object.keys(queryStats.byDate).length > 0 && (
                    <div className="bg-slate-50 rounded-lg p-3 border border-slate-200">
                      <div className="flex items-center gap-2 mb-2">
                        <Calendar className="w-4 h-4 text-slate-600" />
                        <span className="text-sm font-semibold text-slate-700">æŒ‰æ—¥æœŸåˆ†å¸ƒ</span>
                      </div>
                      <div className="grid grid-cols-2 md:grid-cols-4 gap-2 max-h-40 overflow-y-auto">
                        {Object.entries(queryStats.byDate)
                          .sort((a, b) => a[0].localeCompare(b[0]))
                          .map(([date, count]) => {
                            const dateObj = new Date(date);
                            const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
                            const weekday = weekdays[dateObj.getDay()];
                            return (
                              <div key={date} className="flex justify-between items-center text-sm bg-white px-2 py-1.5 rounded border border-slate-200">
                                <span className="text-slate-600">
                                  {dateObj.toLocaleDateString('zh-CN', { month: 'numeric', day: 'numeric' })} ({weekday})
                                </span>
                                <span className="font-semibold text-slate-800">{count}å°</span>
                              </div>
                            );
                          })}
                      </div>
                    </div>
                  )}
                </div>
              </div>
            )}

            <div className="flex flex-wrap items-center justify-between gap-4 mb-6">
              <div className="flex gap-4">
                <div className="bg-white px-4 py-2 rounded-lg shadow-sm border border-slate-100 flex items-center gap-2">
                  <div className="w-2 h-2 rounded-full bg-blue-500"></div>
                  <span className="text-slate-500 text-sm">æ€»å°æ¬¡:</span>
                  <span className="font-bold text-lg">{getDaySurgeries.length}</span>
                </div>
                <div className="bg-white px-4 py-2 rounded-lg shadow-sm border border-slate-100 flex items-center gap-2">
                  <div className="w-2 h-2 rounded-full bg-emerald-500"></div>
                  <span className="text-slate-500 text-sm">å·²å®Œæˆ:</span>
                  <span className="font-bold text-lg">{getDaySurgeries.filter(s => s.status === 'completed').length}</span>
                </div>
              </div>

              <div className="flex gap-2 w-full md:w-auto flex-wrap">
                <button 
                  onClick={handleExportCSV}
                  className="flex-1 md:flex-none flex items-center justify-center gap-2 px-4 py-2 bg-white text-emerald-700 border border-emerald-200 rounded-lg hover:bg-emerald-50 font-medium transition-colors"
                  title="å¯¼å‡ºExcel"
                >
                  <FileSpreadsheet className="w-4 h-4" />
                  <span className="hidden sm:inline">å¯¼å‡º Excel</span>
                </button>
                <button 
                  onClick={copyToClipboard}
                  className="flex-1 md:flex-none flex items-center justify-center gap-2 px-4 py-2 bg-white text-slate-700 border border-slate-200 rounded-lg hover:bg-slate-50 font-medium transition-colors"
                  title="å¤åˆ¶åˆ°å‰ªè´´æ¿"
                >
                  <Copy className="w-4 h-4" />
                  <span className="hidden sm:inline">å¤åˆ¶</span>
                </button>
                <button 
                  onClick={handleExportData}
                  className="flex-1 md:flex-none flex items-center justify-center gap-2 px-4 py-2 bg-white text-blue-700 border border-blue-200 rounded-lg hover:bg-blue-50 font-medium transition-colors"
                  title="å¯¼å‡ºæ‰€æœ‰æ•°æ®ï¼ˆç”¨äºè·¨è®¾å¤‡åŒæ­¥ï¼‰"
                >
                  <Download className="w-4 h-4" />
                  <span className="hidden sm:inline">å¯¼å‡ºæ•°æ®</span>
                </button>
                <button 
                  onClick={handleImportData}
                  className="flex-1 md:flex-none flex items-center justify-center gap-2 px-4 py-2 bg-white text-purple-700 border border-purple-200 rounded-lg hover:bg-purple-50 font-medium transition-colors"
                  title="å¯¼å…¥æ•°æ®ï¼ˆä»å…¶ä»–è®¾å¤‡ï¼‰"
                >
                  <Upload className="w-4 h-4" />
                  <span className="hidden sm:inline">å¯¼å…¥æ•°æ®</span>
                </button>
                <button 
                  onClick={() => { resetForm(); setIsModalOpen(true); }}
                  className="flex-1 md:flex-none flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-md shadow-blue-200 font-medium transition-colors"
                >
                  <Plus className="w-4 h-4" />
                  <span>æ·»åŠ </span>
                </button>
              </div>
            </div>

            {loading ? (
              <div className="text-center py-20 text-slate-400">
                <div className="animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"></div>
                åŠ è½½æ•°æ®ä¸­...
              </div>
            ) : getDaySurgeries.length === 0 ? (
              <div className="text-center py-20 bg-white rounded-2xl border border-dashed border-slate-300">
                <div className="bg-slate-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                  <ClipboardList className="w-8 h-8 text-slate-300" />
                </div>
                <h3 className="text-lg font-medium text-slate-600">
                  {isDateRangeActive && isTimeRangeActive
                    ? 'æ‰€é€‰æ—¥æœŸèŒƒå›´å’Œæ—¶é—´æ®µå†…æš‚æ— æ‰‹æœ¯å®‰æ’'
                    : isDateRangeActive
                      ? 'æ‰€é€‰æ—¥æœŸèŒƒå›´å†…æš‚æ— æ‰‹æœ¯å®‰æ’'
                      : isTimeRangeActive
                        ? 'æ‰€é€‰æ—¶é—´æ®µå†…æš‚æ— æ‰‹æœ¯å®‰æ’'
                        : 'ä»Šæ—¥æš‚æ— æ‰‹æœ¯å®‰æ’'}
                </h3>
                <p className="text-slate-400 text-sm mt-1">
                  {(isDateRangeActive || isTimeRangeActive)
                    ? 'è¯·è°ƒæ•´ç­›é€‰æ¡ä»¶æˆ–ç‚¹å‡»å³ä¸Šè§’"æ·»åŠ "å¼€å§‹æ’ç¨‹'
                    : 'ç‚¹å‡»å³ä¸Šè§’"æ·»åŠ "å¼€å§‹æ’ç¨‹'}
                </p>
              </div>
            ) : (
              <div className="grid gap-4">
                {getDaySurgeries.map((surgery) => (
                  <div 
                    key={surgery.id} 
                    className={`group bg-white rounded-xl p-4 shadow-sm border-l-4 transition-all hover:shadow-md ${
                      surgery.status === 'completed' ? 'border-l-emerald-500' : 
                      surgery.status === 'ongoing' ? 'border-l-blue-500' : 
                      surgery.status === 'cancelled' ? 'border-l-slate-300 opacity-70' : 
                      'border-l-yellow-400'
                    }`}
                  >
                    <div className="flex flex-col md:flex-row gap-4">
                      <div className="flex md:flex-col items-center md:items-start gap-3 md:gap-1 md:w-32 shrink-0 border-b md:border-b-0 md:border-r border-slate-100 pb-3 md:pb-0 md:pr-4">
                        {isDateRangeActive && surgery.date && (
                          <div className="text-xs text-slate-500 font-medium mb-1">
                            {new Date(surgery.date).toLocaleDateString('zh-CN', { month: 'numeric', day: 'numeric' })}
                          </div>
                        )}
                        <div className="flex items-center gap-2">
                           {surgery.sequence && (
                             <div className="bg-blue-600 text-white text-xs font-bold px-1.5 py-0.5 rounded">
                               ç¬¬{surgery.sequence}å°
                             </div>
                           )}
                        </div>
                        <div className="text-xl font-bold text-slate-700 font-mono">{surgery.startTime}</div>
                        <div className="flex items-center gap-1 text-xs font-bold text-slate-500 bg-slate-100 px-2 py-1 rounded w-full md:w-auto overflow-hidden whitespace-nowrap text-ellipsis">
                          <MapPin className="w-3 h-3 flex-shrink-0" />
                          <span className="truncate">{surgery.room || 'æœªå®š'}</span>
                        </div>
                      </div>

                      <div className="flex-1">
                        <div className="flex items-start justify-between">
                          <div>
                            <div className="flex flex-wrap items-center gap-2 mb-1">
                              <h3 className="font-bold text-lg text-slate-800">{surgery.patientName}</h3>
                              {surgery.age && (
                                <span className="text-xs text-slate-600 font-medium bg-slate-100 px-1.5 py-0.5 rounded">
                                  {surgery.age}å²
                                </span>
                              )}
                               {surgery.bedNumber && (
                                <span className="text-xs text-blue-600 font-medium bg-blue-50 px-1.5 py-0.5 rounded flex items-center gap-1">
                                  <Bed className="w-3 h-3" />
                                  {surgery.bedNumber}åºŠ
                                </span>
                              )}
                              {surgery.mrn && (
                                <span className="text-xs text-slate-400 font-mono border px-1 rounded">
                                  #{surgery.mrn}
                                </span>
                              )}
                            </div>
                            <div className="text-blue-700 font-medium mb-2 flex items-center gap-2">
                              {surgery.surgeryName}
                              {surgery.needleSize && (
                                <span className="text-xs border border-blue-200 text-blue-600 px-1.5 rounded-full flex items-center gap-0.5">
                                  <Target className="w-3 h-3" />
                                  {surgery.needleSize}
                                </span>
                              )}
                            </div>
                          </div>
                          
                          <select
                            value={surgery.status}
                            onChange={(e) => updateStatus(surgery.id, e.target.value)}
                            className={`text-xs font-bold px-2 py-1 rounded-full border cursor-pointer outline-none focus:ring-2 focus:ring-offset-1 focus:ring-blue-500 appearance-none text-center ${getStatusColor(surgery.status)}`}
                          >
                            <option value="pending">å¾…æœ¯</option>
                            <option value="ongoing">æœ¯ä¸­</option>
                            <option value="completed">å·²å®Œæˆ</option>
                            <option value="cancelled">å–æ¶ˆ</option>
                          </select>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-y-2 gap-x-4 text-sm text-slate-600 mt-2 bg-slate-50 p-2 rounded-lg">
                          <div className="flex items-center gap-2">
                            <Stethoscope className="w-4 h-4 text-slate-400" />
                            <span className="text-slate-400 text-xs">ä¸»åˆ€:</span>
                            <span className="font-medium text-slate-800">{surgery.surgeon || '-'}</span>
                          </div>
                          {surgery.assistant1 && (
                            <div className="flex items-center gap-2">
                              <User className="w-4 h-4 text-slate-400" />
                              <span className="text-slate-400 text-xs">åŠ©æ‰‹1:</span>
                              <span className="font-medium text-slate-800">{surgery.assistant1}</span>
                            </div>
                          )}
                          {surgery.assistant2 && (
                            <div className="flex items-center gap-2">
                              <User className="w-4 h-4 text-slate-400" />
                              <span className="text-slate-400 text-xs">åŠ©æ‰‹2:</span>
                              <span className="font-medium text-slate-800">{surgery.assistant2}</span>
                            </div>
                          )}
                          <div className="flex items-center gap-2">
                            <Syringe className="w-4 h-4 text-slate-400" />
                            <span className="text-slate-400 text-xs">éº»é†‰:</span>
                            <span className="font-medium text-slate-800">{surgery.anesthesiologist || '-'}</span>
                          </div>
                          <div className="flex items-center gap-2">
                            <UserCheck className="w-4 h-4 text-slate-400" />
                            <span className="text-slate-400 text-xs">å·¡å›:</span>
                            <span className="font-medium text-slate-800">{surgery.circulatingNurse || '-'}</span>
                          </div>
                          {surgery.notes && (
                            <div className="col-span-1 md:col-span-2 flex items-start gap-2 mt-1 text-amber-600 text-xs border-t border-slate-200 pt-1">
                              <AlertCircle className="w-3 h-3 mt-0.5 shrink-0" />
                              {surgery.notes}
                            </div>
                          )}
                        </div>
                      </div>

                      <div className="flex md:flex-col justify-end gap-2 md:pl-4 md:border-l border-slate-100 mt-4 md:mt-0 pt-3 md:pt-0 border-t md:border-t-0">
                        <button 
                          onClick={() => {
                            setEditingSurgery(surgery);
                            setFormData({
                              patientName: surgery.patientName || '',
                              mrn: surgery.mrn || '',
                              age: surgery.age || '',
                              bedNumber: surgery.bedNumber || '',
                              sequence: surgery.sequence || '',
                              surgeryName: surgery.surgeryName || '',
                              needleSize: surgery.needleSize || '',
                              surgeon: surgery.surgeon || '',
                              assistant1: surgery.assistant1 || '',
                              assistant2: surgery.assistant2 || '',
                              anesthesiologist: surgery.anesthesiologist || '',
                              circulatingNurse: surgery.circulatingNurse || '',
                              room: surgery.room || '',
                              startTime: surgery.startTime || '08:00',
                              notes: surgery.notes || '',
                              status: surgery.status || 'pending'
                            });
                            setIsModalOpen(true);
                          }}
                          className="p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-full transition-colors"
                          title="ç¼–è¾‘"
                        >
                          <Edit2 className="w-4 h-4" />
                        </button>
                        <button 
                          onClick={() => handleDelete(surgery.id)}
                          className="p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-full transition-colors"
                          title="åˆ é™¤"
                        >
                          <Trash2 className="w-4 h-4" />
                        </button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </main>

          {isModalOpen && (
            <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
              <div className="bg-white rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto shadow-2xl animate-in fade-in zoom-in-95 duration-200">
                <div className="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50 rounded-t-2xl">
                  <h2 className="text-xl font-bold text-slate-800">
                    {editingSurgery ? 'ç¼–è¾‘æ‰‹æœ¯ä¿¡æ¯' : 'æ·»åŠ æ–°æ‰‹æœ¯'}
                  </h2>
                  <button 
                    onClick={() => setIsModalOpen(false)}
                    className="text-slate-400 hover:text-slate-600 p-1 rounded-full hover:bg-slate-200"
                  >
                    <XCircle className="w-6 h-6" />
                  </button>
                </div>
                
                <form onSubmit={handleSubmit} className="p-6 space-y-4">
                  <div className="grid grid-cols-3 gap-3">
                    <div className="space-y-1">
                      <label className="text-xs font-semibold text-slate-500 uppercase">æ—¥æœŸ</label>
                      <div className="p-2.5 bg-slate-100 rounded-lg text-slate-600 text-xs font-medium flex items-center justify-center">
                        {selectedDate.toLocaleDateString('zh-CN', {month:'numeric', day:'numeric'})}
                      </div>
                    </div>
                    <div className="space-y-1">
                      <label className="text-xs font-semibold text-slate-500 uppercase">æ—¶é—´</label>
                      <input 
                        type="time" 
                        required
                        value={formData.startTime}
                        onChange={(e) => setFormData({...formData, startTime: e.target.value})}
                        className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"
                      />
                    </div>
                     <div className="space-y-1">
                      <label className="text-xs font-semibold text-slate-500 uppercase">å°æ¬¡</label>
                      <div className="relative">
                        <Hash className="absolute left-2.5 top-3 w-3 h-3 text-slate-400" />
                        <input 
                          type="number" 
                          placeholder="1"
                          value={formData.sequence}
                          onChange={(e) => setFormData({...formData, sequence: e.target.value})}
                          className="w-full pl-7 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"
                        />
                      </div>
                    </div>
                  </div>

                   <div className="space-y-1">
                    <label className="text-xs font-semibold text-slate-500 uppercase">æ‰‹æœ¯é—´/åœ°ç‚¹</label>
                    <select
                      value={formData.room}
                      onChange={(e) => setFormData({...formData, room: e.target.value})}
                      className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all"
                    >
                      <option value="">è¯·é€‰æ‹©åœ°ç‚¹</option>
                      <option value="è´Ÿ1æ¥¼CTå®¤">è´Ÿ1æ¥¼CTå®¤</option>
                      <option value="2æ¥¼CTå®¤">2æ¥¼CTå®¤</option>
                      <option value="è¶…å£°ç§‘">è¶…å£°ç§‘</option>
                      <option value="ç—…æˆ¿">ç—…æˆ¿</option>
                    </select>
                  </div>

                  <div className="grid grid-cols-6 gap-3 bg-slate-50 p-3 rounded-lg border border-slate-100">
                    <div className="col-span-2 space-y-1">
                      <label className="text-xs font-semibold text-slate-500 uppercase">ç—…äººå§“å</label>
                      <input 
                        type="text" 
                        required
                        placeholder="å§“å"
                        value={formData.patientName}
                        onChange={(e) => setFormData({...formData, patientName: e.target.value})}
                        className="w-full p-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"
                      />
                    </div>
                    <div className="col-span-1 space-y-1">
                      <label className="text-xs font-semibold text-slate-500 uppercase">å¹´é¾„</label>
                      <input 
                        type="number" 
                        placeholder="å²"
                        value={formData.age}
                        onChange={(e) => setFormData({...formData, age: e.target.value})}
                        className="w-full p-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"
                      />
                    </div>
                    <div className="col-span-1 space-y-1">
                      <label className="text-xs font-semibold text-slate-500 uppercase">åºŠå·</label>
                      <input 
                        type="text" 
                        placeholder="åºŠ"
                        value={formData.bedNumber}
                        onChange={(e) => setFormData({...formData, bedNumber: e.target.value})}
                        className="w-full p-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm"
                      />
                    </div>
                    <div className="col-span-2 space-y-1">
                      <label className="text-xs font-semibold text-slate-500 uppercase">ä½é™¢å·</label>
                      <input 
                        type="text" 
                        placeholder="MRN"
                        value={formData.mrn}
                        onChange={(e) => setFormData({...formData, mrn: e.target.value})}
                        className="w-full p-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm font-mono"
                      />
                    </div>
                  </div>

                  <div className="grid grid-cols-3 gap-3">
                    <div className="col-span-2 space-y-1">
                      <label className="text-xs font-semibold text-slate-500 uppercase">æ‰‹æœ¯/æœ¯å¼åç§°</label>
                      <input 
                        type="text" 
                        required
                        placeholder="ä¾‹å¦‚ï¼šè…¹è…”é•œä¸‹èƒ†å›Šåˆ‡é™¤æœ¯"
                        value={formData.surgeryName}
                        onChange={(e) => setFormData({...formData, surgeryName: e.target.value})}
                        className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all"
                      />
                    </div>
                    <div className="col-span-1 space-y-1">
                      <label className="text-xs font-semibold text-slate-500 uppercase">ç©¿åˆºé’ˆ</label>
                      <select
                        value={formData.needleSize}
                        onChange={(e) => setFormData({...formData, needleSize: e.target.value})}
                        className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all text-sm"
                      >
                        <option value="">æ— /é»˜è®¤</option>
                        <option value="5cm">5cm</option>
                        <option value="10cm">10cm</option>
                        <option value="15cm">15cm</option>
                      </select>
                    </div>
                  </div>

                  <div className="space-y-3 bg-blue-50/50 p-3 rounded-lg border border-blue-100">
                    <div className="space-y-1">
                      <label className="text-xs font-semibold text-slate-500 uppercase">ä¸»åˆ€åŒ»ç”Ÿ</label>
                      <div className="relative">
                        <User className="absolute left-3 top-2.5 w-4 h-4 text-slate-400" />
                        <select 
                          value={formData.surgeon}
                          onChange={(e) => setFormData({...formData, surgeon: e.target.value})}
                          className="w-full pl-9 p-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none appearance-none"
                        >
                          <option value="">è¯·é€‰æ‹©ä¸»åˆ€åŒ»å¸ˆ</option>
                          {surgeonOptions.map((option) => (
                            <option key={option} value={option}>{option}</option>
                          ))}
                        </select>
                      </div>
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                      <div className="space-y-1">
                        <label className="text-xs font-semibold text-slate-500 uppercase">åŠ©æ‰‹1</label>
                        <div className="relative">
                          <User className="absolute left-3 top-2.5 w-4 h-4 text-slate-400" />
                          <select 
                            value={formData.assistant1}
                            onChange={(e) => setFormData({...formData, assistant1: e.target.value})}
                            className="w-full pl-9 p-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none appearance-none"
                          >
                            <option value="">è¯·é€‰æ‹©åŠ©æ‰‹1</option>
                            {surgeonOptions.map((option) => (
                              <option key={option} value={option}>{option}</option>
                            ))}
                          </select>
                        </div>
                      </div>
                      <div className="space-y-1">
                        <label className="text-xs font-semibold text-slate-500 uppercase">åŠ©æ‰‹2</label>
                        <div className="relative">
                          <User className="absolute left-3 top-2.5 w-4 h-4 text-slate-400" />
                          <select 
                            value={formData.assistant2}
                            onChange={(e) => setFormData({...formData, assistant2: e.target.value})}
                            className="w-full pl-9 p-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none appearance-none"
                          >
                            <option value="">è¯·é€‰æ‹©åŠ©æ‰‹2</option>
                            {surgeonOptions.map((option) => (
                              <option key={option} value={option}>{option}</option>
                            ))}
                          </select>
                        </div>
                      </div>
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                      <div className="space-y-1">
                        <label className="text-xs font-semibold text-slate-500 uppercase">éº»é†‰åŒ»å¸ˆ</label>
                        <div className="relative">
                          <Syringe className="absolute left-3 top-2.5 w-4 h-4 text-slate-400" />
                          <select 
                            value={formData.anesthesiologist}
                            onChange={(e) => setFormData({...formData, anesthesiologist: e.target.value})}
                            className="w-full pl-9 p-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none appearance-none"
                          >
                            <option value="">è¯·é€‰æ‹©éº»é†‰åŒ»å¸ˆ</option>
                            {surgeonOptions.map((option) => (
                              <option key={option} value={option}>{option}</option>
                            ))}
                          </select>
                        </div>
                      </div>
                      <div className="space-y-1">
                        <label className="text-xs font-semibold text-slate-500 uppercase">å·¡å›æŠ¤å£«</label>
                        <div className="relative">
                          <UserCheck className="absolute left-3 top-2.5 w-4 h-4 text-slate-400" />
                          <input 
                            type="text" 
                            placeholder="é€‰å¡«"
                            value={formData.circulatingNurse}
                            onChange={(e) => setFormData({...formData, circulatingNurse: e.target.value})}
                            className="w-full pl-9 p-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                          />
                        </div>
                      </div>
                    </div>
                  </div>

                  <div className="space-y-1">
                    <label className="text-xs font-semibold text-slate-500 uppercase">å¤‡æ³¨</label>
                    <textarea 
                      rows="2"
                      placeholder="ç‰¹æ®Šè¦æ±‚..."
                      value={formData.notes}
                      onChange={(e) => setFormData({...formData, notes: e.target.value})}
                      className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all text-sm"
                    ></textarea>
                  </div>

                  <div className="pt-2 flex gap-3">
                    <button 
                      type="button"
                      onClick={() => setIsModalOpen(false)}
                      className="flex-1 py-3 bg-slate-100 text-slate-600 rounded-xl hover:bg-slate-200 font-medium transition-colors"
                    >
                      å–æ¶ˆ
                    </button>
                    <button 
                      type="submit"
                      className="flex-[2] py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 font-medium shadow-lg shadow-blue-200 transition-transform active:scale-95"
                    >
                      {editingSurgery ? 'ä¿å­˜ä¿®æ”¹' : 'ç¡®è®¤æ·»åŠ '}
                    </button>
                  </div>
                </form>
              </div>
            </div>
          )}
        </div>
      );
    }

    // React 16 å…¼å®¹æ¸²æŸ“æ–¹å¼
    ReactDOM.render(React.createElement(SurgeryScheduler), document.getElementById('root'));
  </script>
</body>
</html>
